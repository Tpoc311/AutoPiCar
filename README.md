# AutoPiCar
AutoPiCar - это робототехническая модель, собранная из множества радиомодулей. 
AutoPiCar имеет три важные детали - Raspberry pi 4, Arduino nano и Raspberry Pi Camera Module v 2.1.

## Зачем это нужно?
На самом деле все просто - это моё хобби. 
Это интересно - заставить кучу деталей делать то, что нужно нам, людям.
Хочется прочувствовать, как написанная программа влияет не только на байты информации, но и на что-то материальное. 
Именно поэтому был собран AutoPiCar.

## Как это работает?
AutonomousPiCar можно условно поделить на 2 блока: 
- Управляющий;
- Управляемый.
Управляющий блок - это всё то, что делает Raspberry pi. Сюда можно отнести получение изображений с камеры, их обработка и расчет угла поворота колёс.
Управляемый блок базируется на Arduino. Он отвечает за движение и повороты AutoPiCar.

Таким образом взаимодействие обоих блоков выглядит так:
Raspbrerry pi считает угол, на который нужно повернуть передние колёса, передаёт его на Arduino, а Arduino поворачивает их.
Взаимодействие Raspberyy и Arduino было организовано с помощью UART.

## Окружение
Для имитации дорожной разметки была использована обыкновенная синяя изолента (тут должна быть шутка).

При построении полос движения были учтены некоторые особенности:
- Расстояние между полосами не должно быть слишком большим, поскольку камера не имеет широкоугоьного объектива;
- Повороты должны быть не слишком угловатыми (в силу конструктивных особенностей AutoPiCar не может поворачивать резко).

## Алгоритм распознавания
Задача алгоритма - сформировать линию на каждом кадре, указывающую направление необходимого движения и выдать угол её наклона (в диапазоне от 0 до 180 градусов).

1. Исходное изображение конвертируем в формат HSV. Так мы сможем задать диапазон распознаваемых цветов.
2. Создаём маску для выделения синих областей из заданного диапазона цветов.
3. С помощью детектора границ Кенни находим углы на полученном изображении;
4. Избавляемся от лишних границ, оставляя только дорожную разметку;
5. С помощью преобразования Хаффа получаем координаты линий на изображении;
6. Поскольку на пункте 5 мы получаем координаты не двух линий, а целой кучи, то необходимо их преобразовать.
7. Теперь, когда мы имеем координаты начала и конца обеих полос, считаем угол направляющей линии.

Данный алгоритм описан в документе "Отчёт.docx". Там же поэтопно приведены изображения на каждом этапе алгоритма.

## Инструменты и библиотеки
В проекте были использованы Python 3.7.3 и библиотека OpenCV 3.4.3.
